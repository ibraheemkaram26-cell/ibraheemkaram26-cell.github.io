<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Ramallah Waste Containers</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />

  <style>
    body {
      margin: 0;
      height: 100%;
      width: 100%;
      background-color: #1c1c1c;
      font-family: "Segoe UI", Arial, sans-serif;
    }

    #map {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      bottom: 0;
    }

    /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙÙ„ØªØ±Ø© */
    #filterContainer {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255, 255, 255, 0.95);
      padding: 10px 14px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
      font-size: 14px;
      z-index: 1000;
      transition: 0.3s;
    }

    #filterContainer:hover {
      transform: scale(1.03);
    }

    #filterContainer select {
      padding: 5px 6px;
      border-radius: 4px;
      border: 1px solid #999;
      margin-left: 6px;
    }

    /* Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª */
    #counter {
      position: absolute;
      bottom: 15px;
      right: 15px;
      background: rgba(0, 0, 0, 0.7);
      color: #fff;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 13px;
      z-index: 1000;
    }

    /* Ø²Ø± ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙŠ */
    .leaflet-control-locate {
      background: white;
      padding: 6px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 18px;
      text-align: center;
      line-height: 20px;
    }

    /* Popup ØªØµÙ…ÙŠÙ… Ø£Ø¬Ù…Ù„ */
    .leaflet-popup-content {
      font-size: 14px;
      line-height: 1.5;
    }

    .popup-title {
      color: #ff9800;
      font-weight: bold;
      font-size: 15px;
    }
  </style>
</head>

<body>
  <div id="map"></div>

  <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙÙ„ØªØ±Ø© -->
  <div id="filterContainer">
    <label><b>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§ÙˆÙŠØ©:</b></label>
    <select id="typeFilter">
      <option value="all">Ø§Ù„ÙƒÙ„</option>
      <option value="Plastic">Ø¨Ù„Ø§Ø³ØªÙŠÙƒ</option>
      <option value="Organic">Ø¹Ø¶ÙˆÙŠ</option>
      <option value="Glass">Ø²Ø¬Ø§Ø¬</option>
      <option value="Paper">ÙˆØ±Ù‚</option>
      <option value="Mixed">Ù…Ø®ØªÙ„Ø·</option>
    </select>
  </div>

  <!-- Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª -->
  <div id="counter">Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©: 0</div>

  <!-- JS Libraries -->
  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

  <script>
    // ğŸ—ºï¸ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    const map = L.map("map", {
      center: [31.9045, 35.2045],
      zoom: 17.5,
      zoomSnap: 0.5
    });

    // ğŸ—ºï¸ Ø®Ø±ÙŠØ·ØªØ§Ù† Ø£Ø³Ø§Ø³ÙŠØªØ§Ù† (Ø¯Ø§ÙƒÙ†Ø© + ÙØ§ØªØ­Ø©)
    const darkMap = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap | CARTO',
      subdomains: 'abcd',
      maxZoom: 20
    }).addTo(map);

    const lightMap = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap | CARTO',
      subdomains: 'abcd',
      maxZoom: 20
    });

    let zonesLayer;
    let wasteContainersLayer = L.layerGroup().addTo(map);
    let allContainers = [];

    // ğŸŸ¡ ØªØ­Ù…ÙŠÙ„ Ù…Ù†Ø§Ø·Ù‚ Ø±Ø§Ù… Ø§Ù„Ù„Ù‡
    $.getJSON("RamallahZones.json", function (RZ) {
      zonesLayer = L.geoJson(RZ, {
        style: { fillColor: "yellow", fillOpacity: 0.3, color: "yellow", weight: 1 },
        onEachFeature: (feature, layer) => {
          layer.bindPopup(`<div class='popup-title'>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</div>${feature.properties.NAME}`);
        }
      }).addTo(map);
    });

    // ğŸŸ  ØªØ­Ù…ÙŠÙ„ Ø·Ø¨Ù‚Ø© Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª Ù…Ø¹ Ø£Ù„ÙˆØ§Ù† ÙˆØ£ÙŠÙ‚ÙˆÙ†Ø§Øª + ØªØ£Ø«ÙŠØ± hover
    $.getJSON("wasteContainer.json", function (WC) {
      WC.features.forEach(feature => {
        const latlng = [feature.geometry.coordinates[1], feature.geometry.coordinates[0]];
        const color = getColorByType(feature.properties.TYPE_OF_WA);

        const icon = L.divIcon({
          className: "custom-icon",
          html: `<div style="background:${color}; width:14px; height:14px; border-radius:50%; border:2px solid white;"></div>`,
          iconSize: [14, 14]
        });

        const marker = L.marker(latlng, { icon });

        // Popup Ù…Ù†Ø³Ù‚
        marker.bindPopup(`
          <div class="popup-title">â™»ï¸ Ù†ÙˆØ¹ Ø§Ù„Ù†ÙØ§ÙŠØ§Øª:</div> ${feature.properties.TYPE_OF_WA}<br>
          <div><b>ğŸ“ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª:</b><br>${latlng[0].toFixed(5)}, ${latlng[1].toFixed(5)}</div>
        `);

        // ØªØ£Ø«ÙŠØ± hover
        marker.on("mouseover", () => marker._icon.style.transform = "scale(1.4)");
        marker.on("mouseout", () => marker._icon.style.transform = "scale(1)");

        wasteContainersLayer.addLayer(marker);
        allContainers.push({ marker, type: feature.properties.TYPE_OF_WA });
      });

      updateCounter(allContainers.length);
    });

    // ğŸ¨ Ø£Ù„ÙˆØ§Ù† Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§ÙˆÙŠØ©
    function getColorByType(type) {
      switch (type) {
        case "Plastic": return "#f5b700";
        case "Organic": return "#2ecc71";
        case "Glass": return "#3498db";
        case "Paper": return "#d2691e";
        case "Mixed": return "#bdc3c7";
        default: return "orange";
      }
    }

    // ğŸ” ÙÙ„ØªØ±Ø© Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
    document.getElementById("typeFilter").addEventListener("change", function () {
      const selectedType = this.value;
      wasteContainersLayer.clearLayers();

      const filtered = allContainers.filter(item =>
        selectedType === "all" || item.type === selectedType
      );

      filtered.forEach(item => wasteContainersLayer.addLayer(item.marker));
      updateCounter(filtered.length);
    });

    // ğŸ“Š Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª
    function updateCounter(count) {
      document.getElementById("counter").innerText = `Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©: ${count}`;
    }

    // ğŸ“ Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    L.control.scale({ position: 'bottomleft', imperial: false }).addTo(map);

    // ğŸ” Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø«
    L.Control.geocoder({ position: 'topleft' }).addTo(map);

    // ğŸ§­ Ø²Ø± ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ
    const locateControl = L.control({ position: 'topleft' });
    locateControl.onAdd = function () {
      const div = L.DomUtil.create('div', 'leaflet-control-locate');
      div.innerHTML = "ğŸ“";
      div.title = "ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ";
      div.onclick = function () {
        map.locate({ setView: true, maxZoom: 18 });
      };
      return div;
    };
    locateControl.addTo(map);

    map.on('locationfound', e => {
      L.circleMarker(e.latlng, {
        radius: 6,
        fillColor: 'aqua',
        color: '#00ffff',
        weight: 2,
        fillOpacity: 0.9
      }).addTo(map).bindPopup("ğŸ“ Ø£Ù†Øª Ù‡Ù†Ø§").openPopup();
    });

    // ğŸ—ºï¸ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª
    L.control.layers({ "Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¯Ø§ÙƒÙ†Ø©": darkMap, "Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„ÙØ§ØªØ­Ø©": lightMap }, { "Ø§Ù„Ù…Ù†Ø§Ø·Ù‚": zonesLayer, "Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª": wasteContainersLayer }).addTo(map);
  </script>
</body>
</html>
