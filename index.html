<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Ramallah Waste Containers</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />

  <style>
    body {
      margin: 0;
      height: 100%;
      width: 100%;
      background-color: #1c1c1c;
      font-family: Arial, sans-serif;
    }

    #map {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      bottom: 0;
    }

    /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙÙ„ØªØ±Ø© */
    #filterContainer {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255, 255, 255, 0.9);
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
      z-index: 1000;
    }

    #filterContainer select {
      padding: 4px;
      border-radius: 4px;
      border: 1px solid #999;
    }

    .leaflet-popup-content {
      font-size: 14px;
    }
  </style>
</head>

<body>
  <div id="map"></div>

  <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙÙ„ØªØ±Ø© -->
  <div id="filterContainer">
    <label><b>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§ÙˆÙŠØ©:</b></label>
    <select id="typeFilter">
      <option value="all">Ø§Ù„ÙƒÙ„</option>
      <option value="Plastic">Ø¨Ù„Ø§Ø³ØªÙŠÙƒ</option>
      <option value="Organic">Ø¹Ø¶ÙˆÙŠ</option>
      <option value="Glass">Ø²Ø¬Ø§Ø¬</option>
      <option value="Paper">ÙˆØ±Ù‚</option>
      <option value="Mixed">Ù…Ø®ØªÙ„Ø·</option>
    </select>
  </div>

  <!-- JS Libraries -->
  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

  <script>
    // ğŸ—ºï¸ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    const map = L.map("map", {
      center: [31.9045, 35.2045],
      zoom: 17.5,
      zoomSnap: 0.5
    });

    // ğŸ—ºï¸ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø£Ø³Ø§Ø³
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> | Â© CARTO',
      subdomains: 'abcd',
      maxZoom: 20
    }).addTo(map);

    let zonesLayer;
    let wasteContainersLayer;
    let allContainers = [];

    // ğŸŸ¡ ØªØ­Ù…ÙŠÙ„ Ù…Ù†Ø§Ø·Ù‚ Ø±Ø§Ù… Ø§Ù„Ù„Ù‡
    $.getJSON("RamallahZones.json", function (RZ) {
      zonesLayer = L.geoJson(RZ, {
        style: { fillColor: "yellow", fillOpacity: 0.3, color: "yellow", weight: 1 },
        onEachFeature: function (feature, layer) {
          layer.bindPopup(`<b>Zone Name:</b> ${feature.properties.NAME}`);
        }
      }).addTo(map);
    });

    // ğŸŸ  ØªØ­Ù…ÙŠÙ„ Ø·Ø¨Ù‚Ø© Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª Ù…Ø¹ Ø£Ù„ÙˆØ§Ù† ÙˆØ£ÙŠÙ‚ÙˆÙ†Ø§Øª
    $.getJSON("wasteContainer.json", function (WC) {
      wasteContainersLayer = L.geoJson(WC, {
        pointToLayer: function (feature, latlng) {
          const color = getColorByType(feature.properties.TYPE_OF_WA);
          const icon = L.divIcon({
            className: "custom-icon",
            html: `<div style="background:${color}; width:14px; height:14px; border-radius:50%; border:2px solid white;"></div>`,
            iconSize: [14, 14]
          });
          return L.marker(latlng, { icon: icon });
        },
        onEachFeature: function (feature, layer) {
          layer.bindPopup(`
            <b>â™»ï¸ Ù†ÙˆØ¹ Ø§Ù„Ù†ÙØ§ÙŠØ§Øª:</b> ${feature.properties.TYPE_OF_WA}<br>
            <b>ğŸ“ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª:</b><br>${layer.getLatLng().lat.toFixed(5)}, ${layer.getLatLng().lng.toFixed(5)}
          `);
          allContainers.push(layer);
        }
      }).addTo(map);
    });

    // ğŸ¨ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù„ÙˆÙ† Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§ÙˆÙŠØ©
    function getColorByType(type) {
      switch (type) {
        case "Plastic": return "#f5b700";
        case "Organic": return "#2ecc71";
        case "Glass": return "#3498db";
        case "Paper": return "#d2691e";
        case "Mixed": return "#bdc3c7";
        default: return "orange";
      }
    }

    // ğŸ” ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§ÙˆÙŠØ©
    document.getElementById("typeFilter").addEventListener("change", function () {
      const selectedType = this.value;
      wasteContainersLayer.clearLayers();

      const filtered = allContainers.filter(layer => {
        return selectedType === "all" || layer.feature.properties.TYPE_OF_WA === selectedType;
      });

      filtered.forEach(layer => {
        wasteContainersLayer.addLayer(layer);
      });
    });

    // ğŸ“ Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    L.control.scale({ position: 'bottomleft', imperial: false }).addTo(map);

    // ğŸ” Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø«
    L.Control.geocoder({ position: 'topleft' }).addTo(map);

  </script>
</body>

</html>
